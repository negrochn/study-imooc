# 单例模式

**介绍**

- 系统中被唯一使用
- 一个类只有一个实例



**说明**

- 单例模式需要用到 Java 的特性（ private ）
- ES6 中没有（ TS 除外）
- 只能用 Java 代码来演示 UML 图的内容



**演示**

```java
public class SingleObject {
  // 注意，私有化构造函数，外部不能 new ，只有内部能 new
	private SingleObject() {
    
  }
  // 唯一被 new 出来的对象
  private SingleObject instance = null;
  // 获取对象的唯一接口
  public SingleObject getInstance() {
    if (instance == null) {
      // 只 new 一次
      instance = new SingleObject()
    }
    return instance
  }
  // 对象方法
  public void login(username, password) {
    System.out.printIn("login...")
  }
}
```

```java
// 测试代码
public class SingletonPatternDemo {
  public static void main(String[] args) {
    // 不合法的构造函数
    // 编译时错误：构造函数 SingleObject() 是不可见的！
    // SingleObject object = new SingleObject();
    
    // 获取唯一可用的对象
    SingleObject object = SingleObject.getInstance();
    object.login();
  }
}
```



**场景**

- jQuery 只有一个 $
- 模拟登录框
- 其他
  - 购物车
  - Vuex 和 Redux 中的 Store



jQuery

```js
// jQuery 只有一个 $
if (window.jQuery != null) {
  return window.jQuery
} else {
  // 初始化...
}
```



模拟登录框

```js
class loginForm {
  constructor() {
    this.state = 'hide'
  }
  show() {
    if (this.state === 'show') {
      console.log('已经显示')
      return
    }
    this.state = 'show'
    console.log('登录框成功显示')
  }
  hide() {
    if (this.state === 'hide') {
      console.log('已经隐藏')
      return
    }
    this.state = 'hide'
    console.log('登录框成功隐藏')
  }
}

LoginForm.getInstance = (function() {
  let instance
  return function() {
    if (!instance) {
      instance = new LoginForm()
    }
    return instance
  }
})()
```

```js
// 测试
let login1 = LoginForm.getInstance()
login1.show()

let login2 = LoginForm.getInstance()
login.hide()
```



**设计原则验证**

- 符合单一职责原则，只实例化唯一的对象
- 没法具体体现开放封闭原则，但是绝对不违反开放封闭原则