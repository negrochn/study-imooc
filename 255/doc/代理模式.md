# 代理模式

**介绍**

- 使用者无权访问目标对象
- 中间加代理，通过代理做授权和控制



**演示**

![](https://github.com/negrochn/study-imooc/blob/master/255/img/uml-proxy.jpg)

```js
class RealImg {
  constructor(fileName) {
    this.fileName = fileName
    this.loadFromDisk() // 初始化即从硬盘加载，模拟
  }
  loadFromDisk() {
    console.log(this.fileName, 'loading...')
  }
  display() {
    console.log('display', this.fileName)
  }
}

class ProxyImg {
  constructor(fileName) {
    this.realImg = new RealImg(fileName)
  }
  display() {
    this.realImg.display()
  }
}

// 测试
let proxyImg = new ProxyImg('1.png')
proxyImg.display()
```



**场景**

- 网页事件代理
- jQuery 的 $.proxy
- ES6 的 Proxy



网页事件代理

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Javascript设计模式系统讲解与应用</title>
</head>
<body>
  <div id="div1">
    <a href="#">a1</a>
    <a href="#">a2</a>
    <a href="#">a3</a>
    <a href="#">a4</a>
    <a href="#">a5</a>
  </div>

  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
</body>
</html>
```

```js
const div1 = document.getElementById('div1')
div1.addEventListener('click', e => {
  const target = e.target
  if (target.nodeName === 'A') {
    console.log(target.innerHTML)
  }
})
```



$.proxy

```js
 // 推荐使用 $.proxy 解决，这样就少定义一个变量
$('#div1').click(function() {
  setTimeout($.proxy(function() {
    // this 符合预期
    $(this).css('background-color', 'yellow')
  }, this), 1000)
})
```





**设计原则验证**